<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
  <mapper namespace="mapper.profile">
  	<resultMap id="profile" type="profile">
        <result property="user_id" column="user_id" />
        <result property="nickname" column="nickname" />
        <result property="pro_path" column="pro_path" />
        <result property="following_count" column="following_count" />
        <result property="follower_count" column="follower_count" />
        <result property="board_count" column="board_count" />
        <result property="comment_count" column="comment_count" />
        <result property="likes_count" column="likes_count" />
    </resultMap>
    
    <select id="getProfile" resultMap="profile" parameterType="int">
        <![CDATA[
        SELECT
            u.user_id,
            u.nickname,
            NVL(u.pro_path, '') AS pro_path,
            (SELECT COUNT(*) FROM USER_FOLLOW WHERE opponent_id = u.user_id) AS follower_count,
            (SELECT COUNT(*) FROM USER_FOLLOW WHERE user_id = u.user_id) AS following_count,
            (SELECT COUNT(*) FROM board WHERE user_id = u.user_id) AS board_count,
            (SELECT COUNT(*) FROM comments WHERE user_id = u.user_id) AS comment_count,
            (SELECT COUNT(*) FROM COMMENT_LIKE WHERE user_id = u.user_id) AS likes_count
		FROM
		    users u
		WHERE
		    u.user_id = #{user_id}
        ]]>
    </select>
	
	<update id="updateProfile" parameterType="profile">
       	<![CDATA[
	    UPDATE profile
	    SET 
	        nickname = #{nickname},
	        pro_path = #{pro_path},
	        following_count = #{following_count},
	        follower_count = #{follower_count},
	        board_count = #{board_count},
	        comment_count = #{comment_count},
	        likes_count = #{likes_count}
	    WHERE user_id = #{user_id}
        ]]>
	    
	</update>
	
	<select id="myBoardList" resultType = "com.api.api.board.BoardForm">
       	<![CDATA[
		SELECT 
            board_id,
            section_id,
            forum_id,
            user_id,
            pro_path,
            nickname,
            title,
            content,
            hits,
            like_count,
            comment_count,
            create_date
        FROM 
            board
        WHERE 
            user_id = #{user_id}
        ]]>
	</select>
		
	
	
	
	
    
  
  </mapper>
  
   