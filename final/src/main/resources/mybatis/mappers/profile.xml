<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   

  <mapper namespace="mapper.profile">
  	<resultMap id="profile" type="profile">
        <result property="user_id" column="user_id" />
        <result property="nickname" column="nickname" />
        <result property="pro_path" column="pro_path" />
        <result property="following_count" column="following_count" />
        <result property="follower_count" column="follower_count" />
        <result property="board_count" column="board_count" />
        <result property="comment_count" column="comment_count" />
        <result property="likes_count" column="likes_count" />
    </resultMap>
    
   	<resultMap id="boardform" type="boardform">
        <result property="board_id" column="board_id" />
        <result property="section_id" column="section_id" />
        <result property="forum_id" column="forum_id" />
        <result property="board_like_state" column="board_like_state" />
        <result property="board_save_state" column="board_save_state" />
        <result property="nickname" column="nickname" />
        <result property="user_id" column="user_id" />
        <result property="pro_path" column="pro_path" />
        <result property="title" column="title" />
        <result property="content" column="content" />
        <result property="hits" column="hits" />
        <result property="like_count" column="like_count" />
        <result property="comment_count" column="comment_count" />
        <result property="create_date" column="create_date" />
         <collection  property="img" ofType="boardimg" javaType="List">
			<result property="img_id" column="img_id"/>
			<result property="board_id" column="board_id"/>
			<result property="img_name" column="img_name"/>
			<result property="img_path" column="img_path"/>
		</collection>
		<collection  property="tag" ofType="hashtag" javaType="List">
			<result property="hastag_id" column="hastag_id"/>
			<result property="board_id" column="board_id"/>
			<result property="hashtag_name" column="hashtag_name"/>
		</collection>
	</resultMap>
    
    
    <select id="getProfile" resultMap="profile" parameterType="int">
        <![CDATA[
        SELECT
            u.user_id,
            u.nickname,
            u.user_email,
            NVL(u.pro_path, '') AS pro_path,
            (SELECT COUNT(*) FROM USER_FOLLOW WHERE opponent_id = u.user_id) AS follower_count,
            (SELECT COUNT(*) FROM USER_FOLLOW WHERE user_id = u.user_id) AS following_count,
            (SELECT COUNT(*) FROM board WHERE user_id = u.user_id) AS board_count,
            (SELECT COUNT(*) FROM comments WHERE user_id = u.user_id) AS comment_count,
            (SELECT COUNT(*) FROM COMMENT_LIKE WHERE user_id = u.user_id) AS likes_count
		FROM
		    users u
		WHERE
		    u.user_id = #{user_id}
        ]]>
    </select>
	
	<update id="updateProfile" parameterType="profile">
    	<![CDATA[
	    UPDATE USERS
	    SET 
	        nickname = #{nickname},
	        password = #{password},
	        pro_path = #{pro_path},
	    WHERE user_id = #{user_id}
       	]]>
	</update>
	<select id="getNickname" parameterType="String">
       	<![CDATA[
       	SELECT nickname
       	FROM USERS
       	WHERE nickname=#{nickname}
        ]]>
	</select>
  
  </mapper>
  
   