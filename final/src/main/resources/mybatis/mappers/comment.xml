<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.comment">

	<select id="commentlist"  resultType="commentform" parameterType="commentform" >
	<![CDATA[
	select * from COMMENTS order by comment_id
	]]>
  </select> 
	

	
	<insert id="commentinsert"  parameterType="commentform">
	insert into COMMENTS
	(
	  comment_id
	, board_id
	, user_id
	, content	
	, create_date	
	) values
	(
	AAA.NEXTVAL
	,#{board_id}
	,#{user_id}
	,#{content}
	, SYSDATE
	)
	</insert>
	
	<insert id="pacommentinsert"  parameterType="commentform">
	<selectKey keyProperty="comment_id" resultType="int" order="BEFORE">
        <![CDATA[
        SELECT MAX(comment_id) + 1 from COMMENTS
        ]]>
    	</selectKey>
	insert into COMMENTS
	(
	  comment_id
	, pa_comment_id
	, board_id
	, user_id
	, content	
	, create_date	
	) values
	(
	AAA.NEXTVAL
	,#{pa_comment_id}
	,#{board_id}
	,#{user_id}
	,#{content}
	, SYSDATE
	)
	</insert>
	
	<update id="pacommentcount"  parameterType="int">
	UPDATE COMMENTS
	SET recomment_count = recomment_count + 1
	WHERE comment_id = #{comment_id}
	</update>
	
	<update id="commentcount"  parameterType="int">
	UPDATE board
	SET comment_count = comment_count + 1
	WHERE board_id = #{board_id}
	</update>
	
  
</mapper>